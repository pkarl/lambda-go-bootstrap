# yaml-language-server: $schema=http://json-schema.org/draft-07/schema
name: Deploy AWS CDK + Go Lambda

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.16

      - name: Build Go lambda
        working-directory: ./lambda/healthcheck
        run: |
          go mod download github.com/stretchr/testify
          go build -v main.go

      # - name: Set up Node.js
      #   uses: actions/setup-node@v2
      #   with:
      #     node-version: 18

      # - name: Install JS dependencies
      #   run: |
      #     npm install -g aws-cdk
      #     npm install

      # - name: Deploy CDK Stack
      #   env:
      #     OPENAPI_KEY: ${{ secrets.OPENAPI_KEY }}
      #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      #   run: |
      #     source .venv/bin/activate
      #     npx cdk bootstrap
      #     npx cdk deploy --require-approval never
      #     npx cdk destroy --force

      # - name: Deploy Lambda to AWS using CDK
      #   run: |
      #     mkdir -p lambda
      #     cp healthcheck lambda
      #     cdk deploy